<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="https://fonts.googleapis.com/css2?family=Concert+One&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,900,900i" rel="stylesheet">
<style>
body {
    margin: 0;
    padding: 0;
    background: linear-gradient(to left, #c8e24c, #e2002f);
    background-size: 100% 100%;
    background-repeat: no-repeat;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    max-height: 100vh;
    overflow-x: hidden;
    /* overflow-y: auto; */  /* to allow scrolling if the content is longer than the viewport */
}

.hidden {
    display: none !important;
}
body, html {
    overflow-x: hidden;
    scroll-behavior: smooth;
}

</style>
<title>
   The Myth Of Normal - Book Summary
  </title>
<body>
</head>
</html>
<!---------------------------------->
<!---------- CHAPTER LIST ---------->
<!---------------------------------->
<div class="heading">
<h1>
    The Myth Of Normal
    <span>
    GABOR MAT�
    </span>
</h1>
</div>
<!-------- SEARCHBAR ---------->
<!----------------------------->
<div class="search-bar closed" id="searchContainer">
<div class="hover-detect"></div>
<input id="search-input" required="" type="search"/>
<button class="search-btn" disabled=""><span>Search</span></button>
</div>
<div class="scrollable-area">
<!------ INTRODUCTION ------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-100')">
            INTRODUCTION: Why Normal Is a Myth (And Why That Matters)</a>
    </div>
<!--------- PART I ---------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-101')">
            PART I: Our Interconnected Nature</a>
    </div>
    <ul>
        <li><a href="#" onclick="toggleChapter('chapter-1')">
            Chapter 1: The Last Place You Want to Be: Facets of Trauma</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-2')">
            Chapter 2: Living in an Immaterial World: Emotions, Health, and the Body-Mind Unity</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-3')">
            Chapter 3: You Rattle My Brain: Our Highly Interpersonal Biology</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-4')">
            Chapter 4: Everything I�m Surrounded By: Dispatches from the New Science</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-5')">
            Chapter 5: Mutiny on the Body: The Mystery of the Rebellious Immune System</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-6')">
            Chapter 6: It Ain�t a Thing: Disease as Process</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-7')">
            Chapter 7: A Traumatic Tension: Attachment vs. Authenticity</a></li>
    </ul>
<!-------- PART II ---------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-102')">
            Part II: The Distortion of Human Development</a>
    </div>
    <ul>
        <li><a href="#" onclick="toggleChapter('chapter-8')">
            Chapter 8: Who Are We Really? Human Nature, Human Needs</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-9')">
            Chapter 9: A Sturdy or Fragile Foundation: Children�s Irreducible Needs</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-10')">
            Chapter 10: Trouble at the Threshold(Before We Come into the World)</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-11')">
            Chapter 11: What Choice Do I Have? Childbirth in a Medicalized Culture</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-12')">
            Chapter 12: Horticulture on the Moon: Parenting, Undermined</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-13')">
            Chapter 13: Forcing the Brain in the Wrong Direction: The Sabotage of Childhood</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-14')">
            Chapter 14: A Template for Distress: How Culture Builds Our Character</a></li>
    </ul>
<!-------- PART III --------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-103')">
            Part III: Rethinking Abnormal: Afflictions as Adaptations</a>
    </div>
    <ul>
        <li><a href="#" onclick="toggleChapter('chapter-15')">
            Chapter 15: Just Not to Be You: Debunking the Myths About Addiction</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-16')">
            Chapter 16: Show of Hands: A New View of Addiction</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-17')">
            Chapter 17: An Inaccurate Map of Our Pain: What We Get Wrong About Mental Illness</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-18')">
            Chapter 18: The Mind Can Do Some Amazing Things: From Madness to Meaning</a></li>
    </ul>
<!-------- PART IV ---------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-104')">
            Part IV: The Toxicities of Our Culture</a>
    </div>
    <ul>
        <li><a href="#" onclick="toggleChapter('chapter-19')">
            Chapter 19: From Society to Cell: Uncertainty, Conflict, and Loss of Control</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-20')">
            Chapter 20: Robbing the Human Spirit: Disconnection and Its Discontents</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-21')">
            Chapter 21: They Just Don�t Care If It Kills You: Sociopathy as Strategy</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-22')">
            Chapter 22: The Assaulted Sense of Self: How Race and Class Get Under the Skin</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-23')">
            Chapter 23: Society�s Shock Absorbers: Why Women Have It Worse</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-24')">
            Chapter 24: We Feel Their Pain: Our Trauma-Infused Politics</a></li>
    </ul>
<!--------- PART V ---------->
<!--------------------------->
    <div class="h3">
        <a href="#" onclick="toggleChapter('chapter-105')">
            Part V: Pathways to Wholeness</a>
    </div>
    <ul>
        <li><a href="#" onclick="toggleChapter('chapter-25')">
            Chapter 25: Mind in the Lead: The Possibility of Healing</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-26')">
            Chapter 26: Four A�s and Five Compassions: Some Healing Principles</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-27')">
            Chapter 27: A Dreadful Gift: Disease as Teacher</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-28')">
            Chapter 28: Before the Body Says No: First Steps on the Return to Self</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-29')">
            Chapter 29: Seeing Is Disbelieving: Undoing Self-Limiting Beliefs</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-30')">
            Chapter 30: Foes to Friends: Working with the Obstacles to Healing</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-31')">
            Chapter 31: Jesus in the Tipi: Psychedelics and Healing</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-32')">
            Chapter 32: My Life as a Genuine Thing: Touching Spirit</a></li>
        <li><a href="#" onclick="toggleChapter('chapter-33')">
            Chapter 33: Unmaking a Myth: Visioning a Saner Society</a></li>
    </ul>
</div>
</body>
<!----------------------------------->
<!------ END OF CHAPTER LIST -------->
<!----------------------------------->
<!----->
<!--- SEARCH RESULTS HIGHLIGHTED ----->
<!------------------------------------>
<div class="summary" id="searchResults" style="display: none;">
<button class="toggle-button" id="backToChapters">Back to Chapters</button>
<div id="resultsContainer"><!-- Results will be appended here --></div>
</div>
<!----->
<!------------------------------ >
<!----- CHAPTER 1 ANALYSIS ------>
<div class="summary chapter-summary" id="chapter-1" style="display: none;">
 <button class="toggle-button" onclick="toggleSummary('chapter-1'); showSearchBar()">Hide Summary</button>
    <h2>Structured Overview: CHAPTER 1</h2>
<ul>
    <li>
	<span class="highlighted-text" data-target="list-1" onclick="scrollToSection('list-1')">
	Personal Narrative of Trauma:
	</span>
        The author shares a personal experience demonstrating how past trauma can influence present behavior, showing the long-lasting impact of traumatic events.</li>
    <li>
	<span class="highlighted-text" data-target="list-1" onclick="scrollToSection('list-2')">
	Definition and Nature of Trauma:
	</span>
        Trauma is defined as an inner injury, a lasting rupture within the self due to difficult or hurtful events. It's not the events themselves, but the internal impact they have.</li>
    <li>
	<span class="highlighted-text" data-target="list-1" onclick="scrollToSection('list-3')">
	Trauma’s Impact on Behavior and Relationships:
	</span>
        Trauma significantly shapes behavior, social habits, and ways of thinking. It can disrupt rational thought and significantly affect close relationships.</li>
</ul>
<!-- In-Depth Analysis -->
 <h2>In-Depth Analysis: CHAPTER 1</h2>
 <span class="subheading-text" id="list-1">Heading test 1</span>
 <!-- Content for Personal Narrative of Trauma -->
<p style="margin-bottom: 15px;">
The section on the personal narrative of trauma in the document highlights the profound and lasting impact of traumatic events on individuals. It delves into the story of the author or a character who has experienced a significant traumatic event. This narrative serves as a powerful illustration of how trauma can shape an individual's life, influencing their behavior, relationships, and worldview. The story typically focuses on the internal struggles faced by the individual, such as recurring flashbacks, emotional turmoil, and the challenges in coping with everyday life following the trauma. The narrative emphasizes the complexity of trauma's impact, showing that it's not just the physical scars that linger, but the emotional and psychological ones that can be even more debilitating.
</p>
<p style="margin-bottom: 15px;">
The personal nature of this narrative makes the concept of trauma more tangible and relatable. It moves the discussion from abstract definitions to real-world implications, demonstrating how trauma can disrupt one's sense of self and alter their perception of the world. This narrative also sheds light on the often silent and invisible struggle many individuals face, highlighting the need for understanding, empathy, and support for those who have endured traumatic experiences.
</p>
 <span class="subheading-text" id="list-2">Heading test 2</span>
 <!-- Content for Definition and Nature of Trauma -->
 <p style="margin-bottom: 15px;">
This takeaway explores the essence of trauma, defining it as an internal injury, a disruption within the self that results from difficult or hurtful events. The focus is on the psychological and emotional dimensions of trauma rather than the external events themselves. This definition underscores the subjective nature of trauma; what may be traumatic to one person might not be to another, depending on their individual experiences and resilience.
</p>
<p style="margin-bottom: 15px;">
The nature of trauma is complex and multifaceted. It's not just about the events that cause it but also about how these events are internalized and processed by the individual. Trauma can lead to a wide range of emotional and psychological responses, including fear, helplessness, shock, and confusion. Over time, these reactions can evolve into more chronic conditions such as post-traumatic stress disorder (PTSD), anxiety, and depression.
</p>
<p style="margin-bottom: 15px;">
Understanding the nature of trauma is crucial for both individuals who experience it and those who support them. It helps in recognizing the signs and symptoms of trauma, facilitating early intervention and support. This understanding also challenges the stigma often associated with trauma, acknowledging it as a valid and serious impact on mental health that deserves attention and care.
</p>
 <span class="subheading-text" id="list-3">Heading test 3</span>
 <!-- Content for Trauma�s Impact on Behavior and Relationships -->
 <p style="margin-bottom: 15px;">
Trauma significantly shapes not just the individual psyche but also one's behavior and interactions with others. The document delves into how traumatic experiences can alter an individual's social habits, thought patterns, and relationship dynamics. It highlights the tendency of traumatized individuals to develop coping mechanisms, which may include withdrawal, aggression, or hyper-vigilance. These behaviors often stem from the need to protect oneself from further harm, but they can inadvertently strain relationships and social interactions.
</p>
<p style="margin-bottom: 15px;">
The impact on relationships is particularly profound. Trauma can lead to trust issues, making it difficult for individuals to form close bonds. They may either become overly dependent on others for emotional support or completely isolate themselves to avoid potential hurt. The trauma survivor might also project their fears and insecurities onto others, leading to misunderstandings and conflicts.
</p>
<p style="margin-bottom: 15px;">
Understanding how trauma impacts behavior and relationships is vital for both the survivors and their loved ones. It allows for a more empathetic approach towards behaviors that might otherwise be misunderstood or judged. It also highlights the importance of therapeutic interventions that focus not just on the individual but also on their social environment, helping to rebuild trust, improve communication, and foster healthier relationships.
</p>
</div>
<a id="button"></a>
<script>
document.querySelectorAll('.highlighted-text').forEach(item => {
    item.addEventListener('touchstart', function() {
        scrollToSection(this.getAttribute('data-target'));
    });
});
	
function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.scrollIntoView({ behavior: 'smooth' });
    }
}

	
document.addEventListener('DOMContentLoaded', (event) => {
    var backToTopBtn = document.getElementById("button");

    setInterval(function() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            backToTopBtn.style.opacity = 1;
            backToTopBtn.style.transform = 'translateY(0)'; // Slide into view
        } else {
            backToTopBtn.style.opacity = 0;
            backToTopBtn.style.transform = 'translateY(100%)'; // Slide out of view
        }
    }, 100);

    backToTopBtn.onclick = function() {
        var headingElement = document.querySelector(".heading");
        if (headingElement) {
            headingElement.scrollIntoView({
                behavior: 'smooth'
            });
        }
    };
});

	
let viewState = 'chapterList';

// JavaScript function to toggle visibility of chapter summaries and the scrollable area
function toggleChapter(chapterId) {
    const allChapterSummaries = document.getElementsByClassName("summary");
    for (let i = 0; i < allChapterSummaries.length; i++) {
        const chapter = allChapterSummaries[i];
        if (chapter.id === chapterId) {
            chapter.style.display = "block";
        } else {
            chapter.style.display = "none";
        }
    }

    const scrollableArea = document.querySelector(".scrollable-area");
    scrollableArea.style.display = "none"; // Hide the scrollable area when a chapter summary is displayed.
    
    // Hide the search bar when a chapter summary is displayed
    const searchBarContainer = document.getElementById("searchContainer");
    searchBarContainer.classList.remove("active");
    searchBarContainer.classList.add("closed");
}

// JavaScript function to toggle visibility of individual chapter summary and show the scrollable area
function toggleSummary(chapterId) {
    const chapter = document.getElementById(chapterId);
    chapter.style.display = chapter.style.display === "none" ? "block" : "none";

    const scrollableArea = document.querySelector(".scrollable-area");
    scrollableArea.style.display = "block"; // Show the scrollable area when a chapter summary is toggled.
    
    // Show the search bar when a chapter summary is toggled off
    const searchBarContainer = document.getElementById("searchContainer");
    searchBarContainer.classList.add("active");
    searchBarContainer.classList.remove("closed");
}


// Existing code for opening and closing behavior of the search bar
const searchBar = document.querySelector('#searchContainer input');
const searchContainer = document.querySelector('#searchContainer');
const searchButton = document.querySelector('#searchContainer .search-btn');

searchBar.addEventListener('focus', function() {
    searchContainer.classList.remove('closed');
    searchButton.removeAttribute('disabled');  // Enable the button
});

searchBar.addEventListener('blur', function() {
    // Only disable the button and close the search bar if there's no value in the search bar
    if (!searchBar.value.trim()) {
        searchContainer.classList.add('closed');
        searchButton.setAttribute('disabled', '');  // Disable the button
    }
});





// Transition animation for toggling between Chapter List and Chapter Summaries
function toggleChapter(chapterId) {
    const chapter = document.getElementById(chapterId);
    const chapterList = document.querySelector('.scrollable-area');

    // Move chapterList to the right
    chapterList.style.opacity = 0;
    chapterList.style.transform = 'translateX(100%)';

    setTimeout(() => {
        chapterList.style.display = 'none';

        // Start chapter off-screen to the left
        chapter.style.display = 'grid';
        chapter.style.opacity = 0;
        chapter.style.transform = 'translateX(-100%)';  // Initial state, off to the left
        
        // Fade-in and slide-in effect for the chapter summary
        setTimeout(() => {
            chapter.style.opacity = 1;
            chapter.style.transform = 'translateX(0)';
        }, 50);  
    }, 300);  
}

// Transition animation for hiding Chapter Summaries and showing Chapter List
function toggleSummary(chapterId) {
    const chapter = document.getElementById(chapterId);
    const chapterList = document.querySelector('.scrollable-area');

    // Hide the chapter summary with a fade-out and slide-out effect to the left
    chapter.style.opacity = 0;
    chapter.style.transform = 'translateX(-100%)';

    setTimeout(() => {
        chapter.style.display = 'none';

        chapterList.style.display = 'block';
        chapterList.style.opacity = 0;  
        chapterList.style.transform = 'translateX(100%)';  // Initial state, off to the right

        // Fade-in and slide-in effect for the chapter list
        setTimeout(() => {
            chapterList.style.opacity = 1;
            chapterList.style.transform = 'translateX(0)';
        }, 50);  
    }, 300);  
}











// Function to search through summaries
function searchSummaries() {
    // Get the user's input from the search bar
    let input = document.getElementById("search-input").value.toLowerCase();
    let keywords = input.split(',').map(k => k.trim());  // Split the input by comma and trim each keyword


    // Get all the chapter-summary elements
    let summaries = document.getElementsByClassName("summary");
    let hasSummaryIds = Array.from(summaries).map(summary => summary.id);

    let chapters = document.querySelectorAll('li a');
    for(let chapter of chapters) {
        let onclickAttribute = chapter.getAttribute('onclick');
        if(onclickAttribute) {
            let chapterId = onclickAttribute.replace('toggleChapter(\'', '').replace('\')', '');

            if (hasSummaryIds.includes(chapterId)) {
                let summaryContent = document.getElementById(chapterId).innerText.toLowerCase();
                
                // Check if all keywords match
                let hasAllKeywords = keywords.every(keyword => summaryContent.includes(keyword));

                if (hasAllKeywords || input === "") {
                    chapter.parentNode.style.display = "block";
                } else {
                    chapter.parentNode.style.display = "none";
                }
            } else {
                chapter.parentNode.style.display = "none";
            }
        }
    }
}


// Function to reset the visibility of all chapters
function resetChapterVisibility() {
    const chapters = document.querySelectorAll('.scrollable-area li');
    for (let chapter of chapters) {
        chapter.style.display = 'block';
    }
}

// Add an input event listener to the search input to detect when it's cleared
document.getElementById("search-input").addEventListener('input', function() {
    if (this.value === '') {
        resetChapterVisibility();
    }
});

// Event listener for real-time search as user types
document.getElementById("search-input").addEventListener("keyup", searchSummaries);

document.getElementById("search-input").addEventListener("keyup", function(event) {
    // Check for the "Enter" key
    if (event.keyCode === 13) {
        event.preventDefault();  // Prevent any default behavior (like form submission)

        const keyword = document.getElementById('search-input').value;
        
        // If the search results are already visible, use the update transition
        if (document.getElementById('searchResults').style.display === 'block') {
            updateSearchResults(() => {
                displaySearchResults(keyword);  // Display the updated search results
            });
        } else {
            // Otherwise, use the original transition function
            showSearchResults();
            displaySearchResults(keyword);
        }

        // Set the searchContainer to active
        document.getElementById("searchContainer").classList.add('active');
    } else {
        // If it's not the "Enter" key, continue with the real-time search
        searchSummaries();
    }
});



const searchInput = document.getElementById('search-input');

searchInput.addEventListener('keydown', function(e) {
    if (e.keyCode === 13 || e.key === 'Enter') {
        e.preventDefault(); // Prevent the default action (like form submission)

        // Execute your search logic (same as what you have for the search button)
        const keyword = searchInput.value;

        // If the search results are already visible, use the update transition
        if (document.getElementById('searchResults').style.display === 'block') {
            updateSearchResults(() => {
                displaySearchResults(keyword);  // Display the updated search results
            });
        } else {
            // Otherwise, use the original transition function
            showSearchResults();
            displaySearchResults(keyword);
        }

        // Set the searchContainer to active
        document.getElementById("searchContainer").classList.add('active');

        // If on a mobile device, blur the input to close the keyboard
        if (window.innerWidth < 768) {
            searchInput.blur();
        }
    }
});




// Event listener for ESC button to close the searchbar
searchBar.addEventListener('input', function() {
    escPressCount = 0;
});

let escPressCount = 0;  // Counter to keep track of the number of ESC key presses

document.addEventListener("keydown", function(event) {
    const summaries = document.querySelectorAll('.chapter-summary');
    const openSummary = Array.from(summaries).find(summary => summary.style.display !== 'none');
    const searchInput = document.querySelector('#search-input');

    if (event.key === "Escape") {
        if (openSummary) {
            // If a CHAPTER SUMMARY is open, use the ESC key to hide the summary.
            const summaryId = openSummary.getAttribute('id');
            toggleSummary(summaryId);
            escPressCount = 0;  // Reset the counter
        } else {
            if (window.innerWidth < 768) {
                if (escPressCount === 0) {
                    searchInput.focus();  // Refocus on the search bar
                } else if (escPressCount === 1) {
                    searchInput.value = '';  // Clear the search bar
                } else if (escPressCount === 2) {
                    hideSearchResults();
                    document.getElementById("searchContainer").classList.remove('active');
                    searchInput.blur();  // Remove focus
                    escPressCount = -1;  // Reset to -1 so it will become 0 after incrementing
                }
            } else {
                if (escPressCount === 0) {
                    searchInput.value = '';  // Clear the search bar
                } else if (escPressCount === 1) {
                    hideSearchResults();
                    document.getElementById("searchContainer").classList.remove('active');
                    searchInput.blur();  // Remove focus
                    escPressCount = -1;  // Reset to -1 so it will become 0 after incrementing
                }
            }
            escPressCount++;
        }
    }
});






// Add event listener to the entire document
document.addEventListener('click', function(event) {
    const searchContainer = document.getElementById("searchContainer");
    const searchInput = document.getElementById("search-input");
    
    // Check if the click was outside the searchContainer
    if (!searchContainer.contains(event.target)) {
        // Clear the search bar
        searchInput.value = '';
        resetChapterVisibility();

        // Close the search bar (or any other action you want to achieve)
        // Depending on your CSS, you might have a class to toggle its visibility or appearance
        searchContainer.classList.remove('active');  // Assuming 'active' is the class that makes the search bar appear active
    }
});






// Helper function to get all chapter names from the index page
function getAllChapterNames() {
    const chapterLinks = document.querySelectorAll('.scrollable-area a');
    const chapterNames = [];
    
    chapterLinks.forEach(link => {
        // Extract only the chapter name (without "Chapter X - ")
        const chapterName = link.innerText.split('-')[1].trim();
        chapterNames.push(chapterName);
    });

    return chapterNames;
}

// Search for sentences through the chapter summaries and show them in the place of chapter list
function extractSentences(summaryElement, input) {
    let keywords = [];

    // If the input contains commas, split by comma. Otherwise, treat the whole input as a single keyword (or sentence).
    if (input.includes(',')) {
        keywords = input.split(",").map(k => k.trim().toLowerCase());
    } else {
        keywords = [input.toLowerCase()];
    }

    // Set to store unique sentences
    let uniqueSentences = new Set();

    const relevantNodes = Array.from(summaryElement.querySelectorAll('p, ul, td, ol'));

    keywords.forEach(keyword => {
        relevantNodes.forEach(node => {
            const nodeText = node.innerText || "";
            const regex = new RegExp(`([^\.!?]*${keyword}[^\.!?]*[\.!?])`, 'ig');
            const matches = nodeText.match(regex);
            if (matches) {
                matches.forEach(sentence => {
                    uniqueSentences.add(sentence);
                });
            }
        });
    });

    // Convert set back to array
    return [...uniqueSentences];
}

function displaySearchResults(keywords) {
    const resultsContainer = document.getElementById('resultsContainer');
    resultsContainer.innerHTML = '';  // Clear previous results

    // Split the keywords by comma and trim each keyword
    keywords = keywords.split(",").map(k => k.trim().toLowerCase());

    const summaries = document.querySelectorAll('.chapter-summary');
    summaries.forEach(summary => {
        const chapterText = summary.innerText.toLowerCase();

        // Check if all keywords are present in the chapter
        if (keywords.every(keyword => chapterText.includes(keyword))) {
            const chapterDiv = document.createElement('div');
            const chapterTitle = summary.querySelector('h2').innerText;
            const chapterHeading = document.createElement('h3');
            chapterHeading.innerText = chapterTitle;
            chapterDiv.appendChild(chapterHeading);

            const sentencesList = document.createElement('ul');

            // For each keyword, extract sentences containing that keyword
            keywords.forEach(keyword => {
                const sentences = extractSentences(summary, keyword);
                sentences.forEach(sentence => {
                    const highlighted = sentence.replace(new RegExp(`(${keyword})`, 'ig'), '<span class="highlight">$1</span>');
                    const listItem = document.createElement('li');
                    listItem.innerHTML = highlighted;
                    sentencesList.appendChild(listItem);
                });
            });

            chapterDiv.appendChild(sentencesList);
            resultsContainer.appendChild(chapterDiv);
        }
    });

    showSearchResults();  // Show the results area
}






document.querySelector('.search-btn').addEventListener('click', function() {
    const keyword = document.getElementById('search-input').value;

    // If the search results are already visible, use the update transition
    if (document.getElementById('searchResults').style.display === 'block') {
        updateSearchResults(() => {
            displaySearchResults(keyword);  // Display the updated search results
        });
    } else {
        // Otherwise, use the original transition function
        showSearchResults();
        displaySearchResults(keyword);
    }

    // Set the searchContainer to active
    document.getElementById("searchContainer").classList.add('active');

    // Blur the input to close the keyboard
    document.getElementById('search-input').blur();
});




// Event delegation for the 'backToChapters' button
document.body.addEventListener('click', function(event) {
    if (event.target.id === 'backToChapters') {
        console.log("Back to Chapter list button clicked");
        
        // Use the transition function to hide the search results and show the chapter list
        hideSearchResults();

        // Remove the active class from searchContainer
        document.getElementById("searchContainer").classList.remove('active');
    }
});





// Transition animation for showing the Search Results and hiding Chapter List/Chapter Summaries
function showSearchResults() {
    const searchResults = document.getElementById('searchResults');
    const chapterList = document.querySelector('.scrollable-area');

    // Check if the search results are already displayed
    if (searchResults.style.display === 'grid') {
        // If they are, simply return to avoid the transition
        return;
    }

    chapterList.style.opacity = 0;
    chapterList.style.transform = 'translateX(-100%)';

    // Listen for the end of the chapterList's transition
    chapterList.addEventListener('transitionend', function transitionEndHandler() {
        chapterList.removeEventListener('transitionend', transitionEndHandler);  // Remove the event listener

        chapterList.style.display = 'none';

        searchResults.style.display = 'grid';
        searchResults.style.opacity = 0;
        searchResults.style.transform = 'translateX(100%)';

        setTimeout(() => {
            searchResults.style.opacity = 1;
            searchResults.style.transform = 'translateX(0)';
        }, 50);
    });
}




// Transition animation for hiding Search Results and showing Chapter List
function hideSearchResults() {
    const searchResults = document.getElementById('searchResults');
    const chapterList = document.querySelector('.scrollable-area');
    
    searchResults.style.opacity = 0;
    searchResults.style.transform = 'translateX(100%)';

    setTimeout(() => {
        searchResults.style.display = 'none';

        chapterList.style.display = 'block';
        chapterList.style.opacity = 0;
        chapterList.style.transform = 'translateX(-100%)';

        setTimeout(() => {
            chapterList.style.opacity = 1;
            chapterList.style.transform = 'translateX(0)';
        }, 50);
    }, 300);
}


function updateSearchResults(callback) {
    const searchResults = document.getElementById('searchResults');
    
    // Reset any transform property to ensure there's no slide effect
    searchResults.style.transform = 'none';

    // Fade out the current search results
    searchResults.style.opacity = 0;
    
    setTimeout(() => {
        // After the fade-out, call the provided callback (which will update the content)
        callback();

        // Reset any transform again before fading in
        searchResults.style.transform = 'none';

        // Fade in the updated search results
        searchResults.style.opacity = 1;
    }, 300); // Assuming a 300ms duration, adjust as needed
}


document.getElementById('searchForm').addEventListener('submit', function(e) {
    e.preventDefault(); // Prevent the default form submission behavior

    const keyword = document.getElementById('search-input').value;

    // If the search results are already visible, use the update transition
    if (document.getElementById('searchResults').style.display === 'block') {
        updateSearchResults(() => {
            displaySearchResults(keyword);  // Display the updated search results
        });
    } else {
        // Otherwise, use the original transition function
        showSearchResults();
        displaySearchResults(keyword);
    }

    // Set the searchContainer to active
    document.getElementById("searchContainer").classList.add('active');

    // Blur the input to close the keyboard
    document.getElementById('search-input').blur();
});


</script>

